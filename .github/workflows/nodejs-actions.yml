name: Nodejs Hello World Action
on: push
jobs:
    Image-Build:
        name: Image Buildings
        runs-on: ubuntu-latest
        env:
           EC2_SSH_PRIVATE_KEY: ${{ secrets.EC2_SSH_PRIVATE_KEY }}
           EC2_URL: ${{ secrets.EC2_URL }}
           EC2_USERNAME: ${{ secrets.EC2_USERNAME }}
        steps:
            - name: Build and push image
              uses: docker/login-action@v3
              with:
                username: ${{ vars.DOCKERHUB_USERNAME }}
                password: ${{ secrets.DOCKERHUB_TOKEN }}
            - name: Print Github context
              run: echo "Printing all Github context ${{ github }}"
            - name: Build and push
              uses: docker/build-push-action@v6
              with:
                push: true
                tags: dinesh4363/id-nodeks:${{ github.sha }}
            - name: Install Docker on EC2 Instancesss
              uses: omarhosny206/setup-ssh-for-ec2@v1.0.0
              with:
                EC2_SSH_PRIVATE_KEY: $EC2_SSH_PRIVATE_KEY
                EC2_URL: $EC2_URL
    # then you can run commands/scripts directly on the EC2 instance e.g.:
            - name: Create a new file on the EC2 instance with "hello-world"
              run: ssh -o StrictHostKeyChecking=no $EC2_USERNAME@$EC2_URL "echo "hello-world" >> new_file.txt"